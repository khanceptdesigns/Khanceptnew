<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Editor – KhanceptDesigns</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
body{font-family:"Poppins",sans-serif;background:#f4f4f4;margin:0;padding:20px;}
h1{color:#222;}
form{background:white;padding:20px;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,0.1);max-width:500px;margin-bottom:40px;}
form input, form select{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #ccc;}
form button{padding:10px 15px;background:#000;color:white;border:none;border-radius:8px;cursor:pointer;}
form button:hover{background:#333;}
table{width:100%;border-collapse:collapse;margin-top:20px;}
table th, table td{padding:10px;border:1px solid #ccc;text-align:left;}
table th{background:#eee;}
button.edit, button.delete{padding:5px 10px;margin-right:5px;border:none;border-radius:6px;cursor:pointer;}
button.edit{background:#1E90FF;color:white;} 
button.delete{background:#d40000;color:white;}
tr.dragging{opacity:0.5;}
</style>
</head>
<body>

<h1>Admin Editor – KhanceptDesigns</h1>

<form id="productForm">
  <input type="text" id="name" placeholder="Product Name" required>
  <input type="text" id="desc" placeholder="Description">
  <input type="text" id="img" placeholder="Image URL" required>
  <input type="number" id="salePrice" placeholder="Sale Price" required>
  <input type="number" id="oldPrice" placeholder="Old Price (optional)">
  <input type="text" id="link" placeholder="Product Link" required>
  <input type="text" id="category" placeholder="Category (e.g., Makeup, Skincare)">
  <button type="submit">Add Product</button>
</form>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Category</th>
      <th>Price</th>
      <th>Old Price</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="productTable"></tbody>
</table>

<script>
let allProducts = JSON.parse(localStorage.getItem("allProducts")) || [];
let editIndex = null;

const form = document.getElementById("productForm");
const table = document.getElementById("productTable");

// Render table
function renderTable(){
  table.innerHTML = "";
  allProducts.forEach((prod, index) => {
    const tr = document.createElement("tr");
    tr.setAttribute("draggable", "true");
    tr.dataset.index = index;

    tr.innerHTML = `
      <td>${prod.name}</td>
      <td>${prod.category || "Products"}</td>
      <td>$${prod.salePrice}</td>
      <td>${prod.oldPrice ? "$"+prod.oldPrice : "-"}</td>
      <td>
        <button class="edit" onclick="editProduct(${index})">Edit</button>
        <button class="delete" onclick="deleteProduct(${index})">Delete</button>
      </td>
    `;

    // Drag events
    tr.addEventListener("dragstart", dragStart);
    tr.addEventListener("dragover", dragOver);
    tr.addEventListener("drop", drop);
    tr.addEventListener("dragend", dragEnd);

    table.appendChild(tr);
  });
}

function resetForm(){
  form.reset();
  editIndex = null;
  form.querySelector("button").textContent = "Add Product";
}

// Add / Update product
form.addEventListener("submit", function(e){
  e.preventDefault();
  const product = {
    name: document.getElementById("name").value,
    desc: document.getElementById("desc").value,
    img: document.getElementById("img").value,
    salePrice: parseFloat(document.getElementById("salePrice").value),
    oldPrice: document.getElementById("oldPrice").value ? parseFloat(document.getElementById("oldPrice").value) : null,
    link: document.getElementById("link").value,
    category: document.getElementById("category").value || "Products"
  };

  if(editIndex !== null){
    allProducts[editIndex] = product;
  } else {
    allProducts.push(product);
  }

  localStorage.setItem("allProducts", JSON.stringify(allProducts));
  renderTable();
  resetForm();
});

// Edit product
function editProduct(index){
  const prod = allProducts[index];
  document.getElementById("name").value = prod.name;
  document.getElementById("desc").value = prod.desc;
  document.getElementById("img").value = prod.img;
  document.getElementById("salePrice").value = prod.salePrice;
  document.getElementById("oldPrice").value = prod.oldPrice || "";
  document.getElementById("link").value = prod.link;
  document.getElementById("category").value = prod.category || "";
  editIndex = index;
  form.querySelector("button").textContent = "Update Product";
}

// Delete product
function deleteProduct(index){
  if(confirm("Are you sure you want to delete this product?")){
    allProducts.splice(index,1);
    localStorage.setItem("allProducts", JSON.stringify(allProducts));
    renderTable();
  }
}

// Drag and drop sorting
let dragSrcIndex = null;

function dragStart(e){
  dragSrcIndex = +this.dataset.index;
  this.classList.add("dragging");
}

function dragOver(e){
  e.preventDefault();
}

function drop(e){
  const targetIndex = +this.dataset.index;
  if(dragSrcIndex === targetIndex) return;

  const draggedItem = allProducts[dragSrcIndex];
  allProducts.splice(dragSrcIndex, 1);
  allProducts.splice(targetIndex, 0, draggedItem);

  localStorage.setItem("allProducts", JSON.stringify(allProducts));
  renderTable();
}

function dragEnd(e){
  this.classList.remove("dragging");
}

// Initial render
renderTable();
</script>

</body>
</html>
